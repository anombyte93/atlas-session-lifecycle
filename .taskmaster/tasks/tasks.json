{
  "tasks": [
    {
      "id": 1,
      "title": "Add hook-session-start subcommand to session-init.py",
      "description": "Add a new subcommand 'hook-session-start' to session-init.py that reads session-context files (soul purpose, active context) and returns JSON with systemMessage for Claude's context injection. Must complete in <2 seconds, exit 0 on all errors, handle missing session-context/ directory.",
      "status": "pending",
      "priority": "high",
      "dependencies": [],
      "subtasks": [
        "Read CLAUDE-soul-purpose.md and extract current soul purpose",
        "Read CLAUDE-activeContext.md and extract current goal + open tasks",
        "Format as concise systemMessage (<500 chars)",
        "Return JSON: {\"decision\": \"approve\", \"systemMessage\": \"...\"}"
      ]
    },
    {
      "id": 2,
      "title": "Add hook-pre-compact subcommand to session-init.py",
      "description": "Add 'hook-pre-compact' subcommand that extracts soul purpose + open task count and returns as systemMessage for context re-injection before compaction. Must complete in <1 second. Only inject if soul purpose is active.",
      "status": "pending",
      "priority": "high",
      "dependencies": [],
      "subtasks": [
        "Read soul purpose (skip if no active purpose)",
        "Count open vs completed tasks from active context",
        "Format as ultra-concise systemMessage",
        "Return JSON with decision: approve + systemMessage"
      ]
    },
    {
      "id": 3,
      "title": "Add hook-stop subcommand to session-init.py",
      "description": "Add 'hook-stop' subcommand that checks for active soul purpose and blocks stop if no completion signal found. Reads .claude/session-lifecycle.local.md for state. Checks transcript for <soul-complete> tags. Returns block or approve decision.",
      "status": "pending",
      "priority": "high",
      "dependencies": [],
      "subtasks": [
        "Check if .claude/session-lifecycle.local.md exists and is active",
        "If no state file: approve (no enforcement)",
        "If active: check stop_hook_active flag to prevent loops",
        "If active: scan last N lines of transcript for <soul-complete> tag",
        "If completion signal found: approve. If not: block with reason."
      ]
    },
    {
      "id": 4,
      "title": "Add hook-activate and hook-deactivate subcommands to session-init.py",
      "description": "Add state management subcommands. hook-activate creates .claude/session-lifecycle.local.md with soul purpose and timestamp. hook-deactivate removes it. Used by /start (after brainstorm) and settlement (on close).",
      "status": "pending",
      "priority": "high",
      "dependencies": [],
      "subtasks": [
        "hook-activate --soul-purpose 'X': create YAML-frontmatter .md file",
        "hook-deactivate: remove the state file",
        "State file format: active, soul_purpose, started_at"
      ]
    },
    {
      "id": 5,
      "title": "Create session-hooks.sh shell wrapper",
      "description": "Create ~/.claude/hooks/session-hooks.sh that routes hook events to Python subcommands. Receives event type as $1, reads stdin for hook JSON, delegates to session-init.py. Exits 0 on all error paths.",
      "status": "pending",
      "priority": "high",
      "dependencies": [1, 2, 3, 4],
      "subtasks": [
        "Parse $1 for event type (session-start, stop, pre-compact)",
        "Read stdin JSON and extract project_dir",
        "Route to appropriate Python subcommand",
        "Capture output and forward to stdout",
        "Trap errors and exit 0"
      ]
    },
    {
      "id": 6,
      "title": "Register hooks in settings.local.json",
      "description": "Add SessionStart (5s timeout), Stop (10s timeout), and PreCompact (3s timeout) hooks to ~/.claude/settings.local.json. Preserve existing hooks (auto-enroll-guardian.sh, bw-auto-unlock.sh).",
      "status": "pending",
      "priority": "high",
      "dependencies": [5],
      "subtasks": [
        "Read existing settings.local.json",
        "Add SessionStart hook entry",
        "Add Stop hook entry",
        "Add PreCompact hook entry (if supported)",
        "Verify existing hooks preserved"
      ]
    },
    {
      "id": 7,
      "title": "Add Zai detection logic to SKILL.md",
      "description": "Add runtime detection of Zai MCP availability in SKILL.md. Check for mcp__zaiMCP__zai_spawn_agent tool via ToolSearch at start of Init/Reconcile. Store as ZAI_AVAILABLE boolean.",
      "status": "pending",
      "priority": "medium",
      "dependencies": [],
      "subtasks": [
        "Add Zai MCP Integration section to SKILL.md (already partially done)",
        "Document detection pattern using ToolSearch",
        "Document fallback behavior when Zai unavailable"
      ]
    },
    {
      "id": 8,
      "title": "Implement Zai brainstorm delegation in SKILL.md",
      "description": "Modify Init Step 4 and Reconcile brainstorm flow: when ZAI_AVAILABLE and brainstorm weight is standard/full, spawn Zai agent instead of invoking superpowers:brainstorming skill. Lightweight brainstorms stay with main Claude.",
      "status": "pending",
      "priority": "medium",
      "dependencies": [7],
      "subtasks": [
        "Add Zai brainstorm pattern to Init Step 4",
        "Add Zai brainstorm pattern to Reconcile Step 2/4",
        "Document polling and result retrieval flow",
        "Document fallback to superpowers:brainstorming"
      ]
    },
    {
      "id": 9,
      "title": "Update Work Execution section for Zai delegation in SKILL.md",
      "description": "Modify the Agent Teams Enforcement section: when ZAI_AVAILABLE, use Zai agents (worktree isolation) instead of Claude Agent Teams for implementation. Maintain file ownership via natural worktree isolation.",
      "status": "pending",
      "priority": "medium",
      "dependencies": [7],
      "subtasks": [
        "Add Zai work execution pattern alongside Agent Teams",
        "Document model selection (haiku for implementation, sonnet for complex)",
        "Document status monitoring and diff review flow",
        "Document fallback to Agent Teams when Zai unavailable"
      ]
    },
    {
      "id": 10,
      "title": "Test Zai integration and fallback",
      "description": "Verify Zai integration works when server is running, and gracefully falls back when unavailable. Test both brainstorm delegation and implementation delegation paths.",
      "status": "pending",
      "priority": "medium",
      "dependencies": [8, 9],
      "subtasks": [
        "Test with Zai MCP configured and running",
        "Test with Zai MCP not configured (fallback)",
        "Verify brainstorm output quality from Zai agent",
        "Verify worktree isolation for implementation tasks"
      ]
    },
    {
      "id": 11,
      "title": "Add PR creation step to Settlement Flow in SKILL.md",
      "description": "Add a PR automation step to the Settlement Flow. After feature verification and bounty submission, check if on feature branch, push to remote, create PR via gh pr create. Include soul purpose, commits summary, and features verified count in PR body.",
      "status": "pending",
      "priority": "high",
      "dependencies": [],
      "subtasks": [
        "Check if on feature branch (not main/master)",
        "Push branch with -u flag",
        "Generate PR title from soul purpose",
        "Generate PR body with commits summary and features",
        "Create PR via gh pr create with HEREDOC body",
        "Handle edge cases: on main, no remote, PR exists already"
      ]
    },
    {
      "id": 12,
      "title": "Test PR automation with real branch",
      "description": "Test the PR creation flow by simulating a settlement on the current feature/mcp-zai-architecture branch. Verify PR is created correctly with proper title and body.",
      "status": "pending",
      "priority": "medium",
      "dependencies": [11],
      "subtasks": [
        "Push current branch to remote",
        "Verify PR creation with gh CLI",
        "Verify PR body format",
        "Test edge case: PR already exists"
      ]
    },
    {
      "id": 13,
      "title": "Update SKILL.md to integrate hooks (remove redundant manual calls)",
      "description": "Now that hooks handle automatic context injection, slim down SKILL.md. Add references to hooks, update Init/Reconcile flows to note that hooks handle initial context loading, add hook-activate call after brainstorm and hook-deactivate call in settlement.",
      "status": "pending",
      "priority": "medium",
      "dependencies": [6, 10, 11],
      "subtasks": [
        "Add hooks integration note to Init Mode",
        "Add hooks integration note to Reconcile Mode",
        "Add hook-activate call after brainstorm in Init Step 4",
        "Add hook-deactivate call in Settlement Flow",
        "Note that SessionStart hook handles initial context loading"
      ]
    },
    {
      "id": 14,
      "title": "Sync repo SKILL.md with deployed version",
      "description": "Copy the final deployed ~/.claude/skills/start/SKILL.md to /home/anombyte/Hermes/Projects/_Soul_Purpose_Skill_/SKILL.md and the skills/start/SKILL.md path in the repo.",
      "status": "pending",
      "priority": "high",
      "dependencies": [13],
      "subtasks": [
        "Copy deployed SKILL.md to repo root",
        "Copy to skills/start/SKILL.md if that path exists",
        "Verify diff shows only expected changes"
      ]
    },
    {
      "id": 15,
      "title": "Clean up branch and create PR",
      "description": "Remove/organize branch artifacts (doubt.md, trello screenshot, console logs). Commit all changes. Push branch. Create PR from feature/mcp-zai-architecture to main with comprehensive description of all three pillars (hooks, Zai, PR automation).",
      "status": "pending",
      "priority": "high",
      "dependencies": [14],
      "subtasks": [
        "Move doubt.md to docs/ or remove",
        "Move trello-login-check.png to docs/screenshots/ or remove",
        "Remove console log files if present",
        "Stage and commit all changes",
        "Push branch to remote",
        "Create PR with three-pillar description"
      ]
    }
  ]
}
